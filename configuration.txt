trigger:
  branches:
    include:
      - workspace_publish  # Trigger the pipeline when changes are made to the workspace_publish branch

jobs:
  - job: ValidateJSONFiles
    pool:
      vmImage: 'windows-latest'  # Use a Windows agent for the job
    steps:
      - checkout: self  # Checkout the current repository to access files

      - script: |
          echo "Current Directory: $(System.DefaultWorkingDirectory)"
          echo "Listing files in grxttnlo directory:"
          dir grxttnlo  # List files in the grxttnlo directory

          echo "Starting JSON validation..."
          setlocal enabledelayedexpansion
          set foundJsonFile=false

          for %%i in (grxttnlo\*.json) do (
            set foundJsonFile=true
            echo "Processing file: %%i"
            jq empty "%%i"  # Validate JSON file with jq
            if !errorlevel! neq 0 (
              echo "Error processing file: %%i"
              exit /b 1  # Exit with error if JSON validation fails
            )
          )

          if not !foundJsonFile! == true (
            echo "No JSON files found in grxttnlo directory."
            exit /b 0  # Exit successfully if no JSON files are found
          )

          echo "JSON validation completed successfully."
        displayName: 'Validate JSON Files'

         # Step to publish artifacts
      - task: PublishBuildArtifacts@1
        inputs:
          PathtoPublish: '$(System.DefaultWorkingDirectory)/grxttnlo'  # Path to the folder containing artifacts
          ArtifactName: 'SynapseArtifacts'  # Name of the artifact
          publishLocation: 'Container'  # Publish location
        displayName: 'Publish Artifacts'
